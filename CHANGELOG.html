<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Changelog - crane</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A Nix library for building cargo projects.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Home</a></li><li class="chapter-item expanded affix "><a href="CHANGELOG.html" class="active">Changelog</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction/artifact-reuse.html"><strong aria-hidden="true">1.1.</strong> Artifact reuse</a></li><li class="chapter-item expanded "><a href="introduction/sequential-builds.html"><strong aria-hidden="true">1.2.</strong> Sequential builds</a></li></ol></li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">2.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/quick-start.html"><strong aria-hidden="true">2.1.</strong> Quick start</a></li><li class="chapter-item expanded "><a href="examples/quick-start-simple.html"><strong aria-hidden="true">2.2.</strong> Quick start (simple)</a></li><li class="chapter-item expanded "><a href="examples/quick-start-workspace.html"><strong aria-hidden="true">2.3.</strong> Quick start (workspace)</a></li><li class="chapter-item expanded "><a href="examples/custom-toolchain.html"><strong aria-hidden="true">2.4.</strong> Custom toolchain</a></li><li class="chapter-item expanded "><a href="examples/alt-registry.html"><strong aria-hidden="true">2.5.</strong> Alternative registry</a></li><li class="chapter-item expanded "><a href="examples/build-std.html"><strong aria-hidden="true">2.6.</strong> Building standard library crates</a></li><li class="chapter-item expanded "><a href="examples/cross-rust-overlay.html"><strong aria-hidden="true">2.7.</strong> Cross compiling</a></li><li class="chapter-item expanded "><a href="examples/cross-musl.html"><strong aria-hidden="true">2.8.</strong> Cross compiling with musl</a></li><li class="chapter-item expanded "><a href="examples/cross-windows.html"><strong aria-hidden="true">2.9.</strong> Cross compiling to windows</a></li><li class="chapter-item expanded "><a href="examples/trunk.html"><strong aria-hidden="true">2.10.</strong> Building Trunk projects</a></li><li class="chapter-item expanded "><a href="examples/trunk-workspace.html"><strong aria-hidden="true">2.11.</strong> Workspace with Trunk</a></li><li class="chapter-item expanded "><a href="examples/end-to-end-testing.html"><strong aria-hidden="true">2.12.</strong> End-to-End Testing</a></li><li class="chapter-item expanded "><a href="examples/sqlx.html"><strong aria-hidden="true">2.13.</strong> Building with SQLx</a></li></ol></li><li class="chapter-item expanded "><a href="source-filtering.html"><strong aria-hidden="true">3.</strong> Source filtering</a></li><li class="chapter-item expanded "><a href="local_development.html"><strong aria-hidden="true">4.</strong> Local development</a></li><li class="chapter-item expanded "><a href="custom_cargo_commands.html"><strong aria-hidden="true">5.</strong> Custom cargo commands</a></li><li class="chapter-item expanded "><a href="customizing_builds.html"><strong aria-hidden="true">6.</strong> Customizing builds</a></li><li class="chapter-item expanded "><a href="overriding_derivations.html"><strong aria-hidden="true">7.</strong> Overriding derivations after the fact</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="API.html"><strong aria-hidden="true">8.</strong> API Reference</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="faq/faq.html"><strong aria-hidden="true">9.</strong> Troubleshooting/FAQ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="faq/custom-nixpkgs.html"><strong aria-hidden="true">9.1.</strong> Customizing nixpkgs and other inputs</a></li><li class="chapter-item expanded "><a href="faq/ifd-error.html"><strong aria-hidden="true">9.2.</strong> IFD (import from derivation) errors</a></li><li class="chapter-item expanded "><a href="faq/constant-rebuilds.html"><strong aria-hidden="true">9.3.</strong> Constantly rebuilding from scratch</a></li><li class="chapter-item expanded "><a href="faq/rebuilds-with-different-toolchains.html"><strong aria-hidden="true">9.4.</strong> Crates being rebuilt when using different toolchains</a></li><li class="chapter-item expanded "><a href="faq/rebuilds-with-proc-macros.html"><strong aria-hidden="true">9.5.</strong> Constantly rebuilding proc-macro dependencies dev mode</a></li><li class="chapter-item expanded "><a href="faq/rebuilds-pyo3.html"><strong aria-hidden="true">9.6.</strong> Constantly rebuilding pyo3</a></li><li class="chapter-item expanded "><a href="faq/rebuilds-bindgen.html"><strong aria-hidden="true">9.7.</strong> Constantly rebuilding bindgen</a></li><li class="chapter-item expanded "><a href="faq/no-cargo-lock.html"><strong aria-hidden="true">9.8.</strong> Building upstream cargo crate with no Cargo.lock</a></li><li class="chapter-item expanded "><a href="faq/patching-cargo-lock.html"><strong aria-hidden="true">9.9.</strong> Patching Cargo.lock during build</a></li><li class="chapter-item expanded "><a href="faq/build-workspace-subset.html"><strong aria-hidden="true">9.10.</strong> Building a subset of a workspace</a></li><li class="chapter-item expanded "><a href="faq/building-with-non-rust-includes.html"><strong aria-hidden="true">9.11.</strong> Trouble building when using include_str! (or including other non-rust files)</a></li><li class="chapter-item expanded "><a href="faq/sandbox-unfriendly-build-scripts.html"><strong aria-hidden="true">9.12.</strong> Dealing with sandbox-unfriendly build scripts</a></li><li class="chapter-item expanded "><a href="faq/workspace-not-at-source-root.html"><strong aria-hidden="true">9.13.</strong> Cargo.toml is not at the source root</a></li><li class="chapter-item expanded "><a href="faq/invalid-metadata-files-for-crate.html"><strong aria-hidden="true">9.14.</strong> Found invalid metadata files for crate error</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="advanced/advanced.html"><strong aria-hidden="true">10.</strong> Advanced Techniques</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/overriding-function-behavior.html"><strong aria-hidden="true">10.1.</strong> Overriding function behavior</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">crane</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ipetkov/crane" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ipetkov/crane/edit/master/docs/./CHANGELOG.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p>All notable changes to this project will be documented in this file.</p>
<p>The format is based on <a href="http://keepachangelog.com/en/1.0.0/">Keep a Changelog</a>
and this project adheres to <a href="http://semver.org/spec/v2.0.0.html">Semantic Versioning</a>.</p>
<h2 id="unreleased"><a class="header" href="#unreleased">Unreleased</a></h2>
<h2 id="0164---2024-04-07"><a class="header" href="#0164---2024-04-07"><a href="https://github.com/ipetkov/crane/compare/v0.16.3...v0.16.4">0.16.4</a> - 2024-04-07</a></h2>
<h3 id="added"><a class="header" href="#added">Added</a></h3>
<ul>
<li>Added a warning if an unsupported version of nixpkgs is used</li>
</ul>
<h3 id="changed"><a class="header" href="#changed">Changed</a></h3>
<ul>
<li><code>cargoNextest</code> now supports setting <code>withLlvmCov</code> which will automatically run
<code>cargo llvm-cov nextest</code>. Note that <code>withLlvmCov = true;</code> is (currently) only
supported when <code>partitions = 1;</code></li>
</ul>
<h3 id="fixed"><a class="header" href="#fixed">Fixed</a></h3>
<ul>
<li><code>inheritCargoArtifactsHook</code> and <code>installCargoArtifactsHook</code> now correctly
handle the case when <code>CARGO_TARGET_DIR</code> is set to a nested directory</li>
<li>Dependency vendoring now correctly takes unused patch dependencies into
account</li>
<li>Workspace inheritance for git dependencies now ignores (removes) all comments
around dependency declarations to work around a mangling bug in <code>toml_edit</code>
(see https://github.com/ipetkov/crane/issues/527 and
https://github.com/toml-rs/toml/issues/691)</li>
</ul>
<h2 id="0163---2024-03-19"><a class="header" href="#0163---2024-03-19"><a href="https://github.com/ipetkov/crane/compare/v0.16.2...v0.16.3">0.16.3</a> - 2024-03-19</a></h2>
<h3 id="changed-1"><a class="header" href="#changed-1">Changed</a></h3>
<ul>
<li>Sources are now fetched <a href="https://blog.rust-lang.org/2024/03/11/crates-io-download-changes.html">crates.io's
CDN</a>,
following cargo's (new) default behavior.</li>
</ul>
<h3 id="fixed-1"><a class="header" href="#fixed-1">Fixed</a></h3>
<ul>
<li><code>vendorMultipleCargoDeps</code> correctly lists <code>registries</code> as an optional
parameter</li>
</ul>
<h2 id="0162---2024-02-21"><a class="header" href="#0162---2024-02-21"><a href="https://github.com/ipetkov/crane/compare/v0.16.1...v0.16.2">0.16.2</a> - 2024-02-21</a></h2>
<h3 id="changed-2"><a class="header" href="#changed-2">Changed</a></h3>
<ul>
<li><code>cleanCargoToml</code> now also strips out <code>[lints]</code> and <code>[workspace.lints]</code>
definitions. This means avoiding unnecessarily rebuilding dependencies when
the lint definitions change, and it avoids issues with failing to build
dummified sources which might have violated a lint marked as <code>deny</code> or
<code>forbid</code></li>
</ul>
<h3 id="fixed-2"><a class="header" href="#fixed-2">Fixed</a></h3>
<ul>
<li>Fixed an edge case with inheriting workspace dependencies where the workspace
dependency is a string (e.g. <code>foo = "0.1.2"</code>) but the crate definition is a
table (e.g. <code>foo = { workspace = true, optional = true }</code>)</li>
</ul>
<h2 id="0161---2024-01-28"><a class="header" href="#0161---2024-01-28"><a href="https://github.com/ipetkov/crane/compare/v0.16.0...v0.16.1">0.16.1</a> - 2024-01-28</a></h2>
<h3 id="changed-3"><a class="header" href="#changed-3">Changed</a></h3>
<ul>
<li><code>buildDepsOnly</code> now ignores any outputs (besides the default <code>out</code>)</li>
</ul>
<h3 id="fixed-3"><a class="header" href="#fixed-3">Fixed</a></h3>
<ul>
<li><code>buildDepsOnly</code> no longer fails when workspace is configured with
<code>#[deny(unused-extern-crates)]</code></li>
<li><code>vendorCargoDeps</code> (and friends) are now much more friendly to
cross-compilation definitions. Specifically, source vendoring will always
build dependencies to run on the build machine (and not for the host we're
cross compiling to).</li>
</ul>
<h2 id="0160---2024-01-18"><a class="header" href="#0160---2024-01-18"><a href="https://github.com/ipetkov/crane/compare/v0.15.1...v0.16.0">0.16.0</a> - 2024-01-18</a></h2>
<h3 id="changed-4"><a class="header" href="#changed-4">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: dropped compatibility for Nix versions below 2.18.1</li>
<li><strong>Breaking</strong>: dropped compatibility for nixpkgs-23.05.</li>
<li><code>buildTrunkPackage</code> has a new argument, <code>wasm-bindgen-cli</code> must be set
to avoid mismatching versions between the wasm-bindgen library and CLI tool.</li>
</ul>
<h3 id="fixed-4"><a class="header" href="#fixed-4">Fixed</a></h3>
<ul>
<li>Workspace inheritance of <code>lints</code> in git dependencies is now correctly handled</li>
</ul>
<h2 id="0151---2023-11-30"><a class="header" href="#0151---2023-11-30"><a href="https://github.com/ipetkov/crane/compare/v0.15.0...v0.15.1">0.15.1</a> - 2023-11-30</a></h2>
<h3 id="changed-5"><a class="header" href="#changed-5">Changed</a></h3>
<ul>
<li><code>buildDepsOnly</code> will now assume <code>cargoTestExtraArgs = "--no-run";</code> if not
specified (since there is no point to trying to run tests with the stripped
sources). To get the old behavior back, set <code>cargoTestExtraArgs = "";</code></li>
</ul>
<h3 id="fixed-5"><a class="header" href="#fixed-5">Fixed</a></h3>
<ul>
<li><code>buildTrunkPackage</code>'s <code>preConfigure</code> script to fail quicker with a more
obvious error message if dependencies at not appropriately met</li>
</ul>
<h2 id="0150---2023-11-05"><a class="header" href="#0150---2023-11-05"><a href="https://github.com/ipetkov/crane/compare/v0.14.3...v0.15.0">0.15.0</a> - 2023-11-05</a></h2>
<h3 id="added-1"><a class="header" href="#added-1">Added</a></h3>
<ul>
<li><code>cargoDeny</code> added for running <a href="https://github.com/EmbarkStudios/cargo-deny"><code>cargo-deny</code></a>.</li>
<li><code>installCargoArtifactsHook</code> will now pass along the contents of
<code>$zstdCompressionExtraArgs</code> as arguments to <code>zstd</code> when compressing artifacts.
This allows for tailoring compression behavior, for example, by setting
<code>zstdCompressionExtraArgs = "-19";</code> on the derivation.</li>
</ul>
<h3 id="changed-6"><a class="header" href="#changed-6">Changed</a></h3>
<ul>
<li>The <code>use-zstd</code> artifact installation mode now uses a chained, incremental
approach to avoid redundancy. Old behavior (taking a full snapshot of the
cargo artifacts) can be achieved by setting <code>doCompressAndInstallFullArchive = true</code>.</li>
<li>The default <code>installCargoArtifactsMode</code> has been changed to <code>use-zstd</code>,
meaning cargo artifacts will be compressed to a series of incremental, zstd
compressed tarballs across derivations. To get the old behavior back, set
<code>installCargoArtifactsMode = "use-symlink"</code> to any derivation which produces
cargo artifacts.</li>
<li>All dependencies (outside of <code>nixpkgs</code>) have been dropped from the (main)
flake.lock file so they do not pollute downstream projects' lock files.</li>
</ul>
<h3 id="fixed-6"><a class="header" href="#fixed-6">Fixed</a></h3>
<ul>
<li><code>mkDummySrc</code> now properly handles file cleaning (and file including) when a
build is invoked with a <code>--store ...</code> override</li>
</ul>
<h2 id="0143---2023-10-17"><a class="header" href="#0143---2023-10-17"><a href="https://github.com/ipetkov/crane/compare/v0.14.2...v0.14.3">0.14.3</a> - 2023-10-17</a></h2>
<h3 id="changed-7"><a class="header" href="#changed-7">Changed</a></h3>
<ul>
<li><code>craneUtils</code> will now be built with the <code>rustPlatform</code> provided by nixpkgs
instead of the currently configured toolchain. This should hopefully result in
fewer surprises for those testing with really old MSRV toolchains.</li>
<li><code>devShell</code> will now additionally include <code>clippy</code> and <code>rustfmt</code> from the
currently configured toolchain</li>
</ul>
<h3 id="fixed-7"><a class="header" href="#fixed-7">Fixed</a></h3>
<ul>
<li><code>replaceCargoLockHook</code> now runs as a <code>prePatch</code> hook (rather
than <code>postUnpack</code>) which correctly replaces the <code>Cargo.lock</code> in the source
directory rather than the parent directory</li>
</ul>
<h2 id="0142---2023-10-15"><a class="header" href="#0142---2023-10-15"><a href="https://github.com/ipetkov/crane/compare/v0.14.1...v0.14.2">0.14.2</a> - 2023-10-15</a></h2>
<h3 id="added-2"><a class="header" href="#added-2">Added</a></h3>
<ul>
<li><code>replaceCargoLockHook</code> can now be used to easily replace or insert a
<code>Cargo.lock</code> file in the current derivation</li>
</ul>
<h3 id="changed-8"><a class="header" href="#changed-8">Changed</a></h3>
<ul>
<li><code>cargoAudit</code> will pass <code>--ignore yanked</code> by default if <code>cargoAuditExtraArgs</code>
are not specified. This is because <code>cargo-audit</code> cannot check for yanked
crates from inside of the sandbox. To get the old behavior back, set
<code>cargoAuditExtraArgs = "";</code>.</li>
</ul>
<h3 id="fixed-8"><a class="header" href="#fixed-8">Fixed</a></h3>
<ul>
<li>Fixed handling of Cargo workspace inheritance for git-dependencies where said
crate relies on reading non-TOML metadata (i.e. comments) from its Cargo.toml
at build time. (<a href="https://github.com/ipetkov/crane/pull/407">#407</a>)</li>
<li>Fixed handling of dummy target names to avoid issues with <code>cargo doc</code>.
(<a href="https://github.com/ipetkov/crane/pull/410">#410</a>)</li>
<li>When using <code>installCargoArtifactsMode = "use-zstd";</code> all files will be marked
as user-writable while compressing</li>
<li><code>removeReferencesToVendoredSources</code> now signs <code>aarch64-darwin</code> binaries. (<a href="https://github.com/ipetkov/crane/pull/418">#418</a>)</li>
</ul>
<h2 id="0141---2023-09-23"><a class="header" href="#0141---2023-09-23"><a href="https://github.com/ipetkov/crane/compare/v0.14.0...v0.14.1">0.14.1</a> - 2023-09-23</a></h2>
<h3 id="fixed-9"><a class="header" href="#fixed-9">Fixed</a></h3>
<ul>
<li>Fixed a bug where <code>buildPackage</code> would fail to inherit artifacts from
dependency crates if <code>cargoArtifacts</code> was not explicitly specified.</li>
</ul>
<h2 id="0140---2023-09-21"><a class="header" href="#0140---2023-09-21"><a href="https://github.com/ipetkov/crane/compare/v0.13.1...v0.14.0">0.14.0</a> - 2023-09-21</a></h2>
<h3 id="added-3"><a class="header" href="#added-3">Added</a></h3>
<ul>
<li>Added <code>devShell</code>, a thin wrapper around <code>pkgs.mkShell</code> which automatically
provides <code>cargo</code> and <code>rustc</code>.</li>
<li>Added the ability to specify output hashes of git dependencies for fully
offline evaluations. The <code>outputHashes</code> attribute can now be optionally
specified in <code>vendorCargoDeps</code>, <code>vendorGitDeps</code>, <code>vendorMultipleCargoDeps</code>, or
anything else which delegates to them.</li>
</ul>
<h3 id="changed-9"><a class="header" href="#changed-9">Changed</a></h3>
<ul>
<li><strong>Breaking</strong> (technically): <code>buildDepsOnly</code>, <code>buildPackage</code>, <code>cargoBuild</code>,
<code>cargoClippy</code>, <code>cargoDoc</code>, <code>cargoLlvmCov</code>, and <code>cargoTest</code>'s defaults have
been changed such that if <code>cargoExtraArgs</code> have not been set, a default value
of <code>--locked</code> will be used. This ensures that a project's committed
<code>Cargo.lock</code> is exactly what is expected (without implicit changes at build
time) but this may end up rejecting builds which were previously passing. To
get the old behavior back, set <code>cargoExtraArgs = "";</code></li>
<li><strong>Breaking</strong>: <code>cargoDoc</code> will no longer install cargo artifacts by default.
Set <code>doInstallCargoArtifacts = true;</code> to get the old behavior back.</li>
<li><code>cargoDoc</code> will now install generated documentation in <code>$out/share/doc</code></li>
<li>Fixed a bug when testing proc macro crates with <code>cargoNextest</code> on macOS.
(<a href="https://github.com/ipetkov/crane/pull/376">#376</a>)</li>
<li>Replaced various internal usages of <code>runCommandLocal</code> with <code>runCommand</code> for
more optimal behavior when downloading cached artifacts</li>
</ul>
<h2 id="0131---2023-08-22"><a class="header" href="#0131---2023-08-22"><a href="https://github.com/ipetkov/crane/compare/v0.13.0...v0.13.1">0.13.1</a> - 2023-08-22</a></h2>
<h3 id="changed-10"><a class="header" href="#changed-10">Changed</a></h3>
<ul>
<li><code>buildTrunkPackage</code> will now use <code>dart-sass</code> instead of <code>nodePackages.sass</code></li>
<li>Vendoring git dependencies will now always resolve symlinks inside of a
crate's directory. This allows for symlinks inside of a crate's directory to
possibly refer to files at the root of the git repo itself (via symlink) and
have those contents preserved during vendoring.</li>
</ul>
<h2 id="0130---2023-08-07"><a class="header" href="#0130---2023-08-07"><a href="https://github.com/ipetkov/crane/compare/v0.12.2...v0.13.0">0.13.0</a> - 2023-08-07</a></h2>
<h3 id="added-4"><a class="header" href="#added-4">Added</a></h3>
<ul>
<li><code>buildPackage</code> now supports installing <code>dylib</code> targets</li>
<li>Added support for sparse registries</li>
</ul>
<h3 id="changed-11"><a class="header" href="#changed-11">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: dropped compatibility for Nix versions below 2.13.3</li>
<li><strong>Breaking</strong>: dropped compatibility for nixpkgs-22.05. nixpkgs-23.05 and</li>
<li><strong>Breaking</strong> (technically): if <code>buildPackage</code> is called <em>without</em> setting
<code>cargoArtifacts</code>, the default <code>buildDepsOnly</code> invocation will now stop running
any installation hooks</li>
<li><strong>Breaking</strong> (technically): <code>buildPackage</code> no longer installs cargo binary
dependencies (i.e. when the <code>bindeps</code> feature is used) by default</li>
<li><code>inheritCargoArtifactsHook</code> will now symlink dependency <code>.rlib</code> and <code>.rmeta</code>
files. This means that derivations which reuse existing cargo artifacts will
run faster as fewer files (and bytes!) need to be copied around. To disable
this behavior, set <code>doNotLinkInheritedArtifacts = true;</code>.</li>
<li><code>cargoTarpaulin</code> will now set <code>doNotLinkInheritedArtifacts = true;</code> unless
otherwise specified</li>
<li>Update <code>crane-utils</code> dependencies for successful build in nightly Rust (2023-06-28)</li>
</ul>
<h2 id="0122---2023-06-06"><a class="header" href="#0122---2023-06-06"><a href="https://github.com/ipetkov/crane/compare/v0.12.1...v0.12.2">0.12.2</a> - 2023-06-06</a></h2>
<h3 id="added-5"><a class="header" href="#added-5">Added</a></h3>
<ul>
<li>Added support for the <a href="https://trunkrs.dev">Trunk</a> wasm app build tool</li>
</ul>
<h3 id="changed-12"><a class="header" href="#changed-12">Changed</a></h3>
<ul>
<li><code>resolver</code> key is no longer cleaned from Cargo.toml</li>
</ul>
<h3 id="fixed-10"><a class="header" href="#fixed-10">Fixed</a></h3>
<ul>
<li><code>buildTrunkPackage</code> will now strip references to store files by default</li>
<li><code>buildTrunkPackage</code> will now set the right <code>wasm-opt</code> version</li>
</ul>
<h2 id="0121---2023-04-10"><a class="header" href="#0121---2023-04-10"><a href="https://github.com/ipetkov/crane/compare/v0.12.0...v0.12.1">0.12.1</a> - 2023-04-10</a></h2>
<h3 id="changed-13"><a class="header" href="#changed-13">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: When setting a default value for <code>cargoArtifacts</code>,
<code>buildPackage</code> will now ignore <code>installPhase</code> and <code>installPhaseCommand</code> when
calling <code>buildPackage</code>. To bring back the old behavior, please specify
<code>cargoArtifacts</code> explicitly</li>
</ul>
<h3 id="added-6"><a class="header" href="#added-6">Added</a></h3>
<ul>
<li><code>vendorMultipleCargoDeps</code> can now be used to vendor crates from multiple
distinct <code>Cargo.lock</code> files. Notably this allows for building the standard
library (via <code>-Z build-std</code> or equivalent) since both the project's
and the Rust toolchain's <code>Cargo.lock</code> files can be vendored together</li>
</ul>
<h3 id="changed-14"><a class="header" href="#changed-14">Changed</a></h3>
<ul>
<li><code>vendorCargoRegistries</code> now accepts a <code>registries</code> parameter from the caller.
If not specified, it will be computed via <code>cargoConfigs</code>. Also <code>cargoConfigs</code>
is now an optional parameter which will default to <code>[]</code> if not specified.</li>
</ul>
<h3 id="fixed-11"><a class="header" href="#fixed-11">Fixed</a></h3>
<ul>
<li><code>vendorCargoDeps</code> correctly accepts arguments which have <em>not</em> set <code>src</code>, so
long as one of <code>cargoLock</code>, <code>cargoLockContents</code>, or <code>cargoLockParsed</code> is set</li>
</ul>
<h2 id="0120---2023-03-19"><a class="header" href="#0120---2023-03-19"><a href="https://github.com/ipetkov/crane/compare/v0.11.3...v0.12.0">0.12.0</a> - 2023-03-19</a></h2>
<h3 id="added-7"><a class="header" href="#added-7">Added</a></h3>
<ul>
<li>Add a stubbed binary target to each "dummy" crate generated to support
<a href="https://doc.rust-lang.org/cargo/reference/unstable.html#artifact-dependencies">"artifact dependencies" nightly feature</a>
in case a crate is used as <code>bin</code> artifact dependency.</li>
<li>Add <code>cargoLlvmCov</code> to run <code>cargo llvm-cov</code></li>
<li>Add <code>cargoLockParsed</code> option to <code>vendorCargoDeps</code> to support <code>Cargo.lock</code>
files parsed as nix attribute sets.</li>
<li><code>craneLib.path</code> can now be used as a convenience wrapper on (or drop in
replacement of) <code>builtins.path</code> to ensure reproducible results whenever paths
like <code>./.</code> or <code>./..</code> are used directly.</li>
</ul>
<h3 id="changed-15"><a class="header" href="#changed-15">Changed</a></h3>
<ul>
<li><strong>Breaking</strong> (technically): <code>mkCargoDerivation</code> will remove the following
attributes before lowering to <code>mkDerivation</code>: <code>cargoLock</code>, <code>cargoLockContents</code>
and <code>cargoLockParsed</code>. If your derivation needs these values to be present
they can be explicitly passed through via <code>.overrideAttrs</code>
<code>buildDepsOnly</code> as <code>dummySrc</code> will take priority</li>
<li>The API docs have been updated to refer to <code>craneLib</code> (instead of just <code>lib</code>)
to avoid ambiguities with <code>pkgs.lib</code>.</li>
<li>cargo is now invoked with <code>--release</code> when <code>$CARGO_PROFILE == release</code> instead
of passing in <code>--profile release</code> to better support tools which do not
understand the latter</li>
</ul>
<h3 id="fixed-12"><a class="header" href="#fixed-12">Fixed</a></h3>
<ul>
<li>Fixed support for projects depending on crates utilising per-target workspace dependencies.</li>
</ul>
<h2 id="0113---2023-02-19"><a class="header" href="#0113---2023-02-19"><a href="https://github.com/ipetkov/crane/compare/v0.11.2...v0.11.3">0.11.3</a> - 2023-02-19</a></h2>
<h3 id="fixed-13"><a class="header" href="#fixed-13">Fixed</a></h3>
<ul>
<li>Fixed an unintentional cache invalidation whenever <code>buildDepsOnly</code> would run
on an unfiltered source (like <code>src = ./.;</code>).</li>
</ul>
<h3 id="changed-16"><a class="header" href="#changed-16">Changed</a></h3>
<ul>
<li>A warning will now be emitted if a derivation's <code>pname</code> or <code>version</code>
attributes are not set and the value cannot be loaded from the derivation's
root <code>Cargo.toml</code>. To resolve it consider setting <code>pname = "...";</code> or <code>version = "...";</code> explicitly on the derivation.</li>
<li>A warning will now be emitted if <code>src</code> and <code>dummySrc</code> are passed to
<code>buildDepsOnly</code> as <code>dummySrc</code> will take priority</li>
</ul>
<h2 id="0112---2023-02-11"><a class="header" href="#0112---2023-02-11"><a href="https://github.com/ipetkov/crane/compare/v0.11.1...v0.11.2">0.11.2</a> - 2023-02-11</a></h2>
<h3 id="fixed-14"><a class="header" href="#fixed-14">Fixed</a></h3>
<ul>
<li><code>buildPackage</code> is more tolerant of misbehaving proc macros which write to
stdout during the build</li>
</ul>
<h2 id="0111---2023-01-21"><a class="header" href="#0111---2023-01-21"><a href="https://github.com/ipetkov/crane/compare/v0.11.0...v0.11.1">0.11.1</a> - 2023-01-21</a></h2>
<h3 id="changed-17"><a class="header" href="#changed-17">Changed</a></h3>
<ul>
<li>Documented and made it easier to build a cargo workspace located in a
subdirectory of the source root</li>
</ul>
<h3 id="fixed-15"><a class="header" href="#fixed-15">Fixed</a></h3>
<ul>
<li>Previously compiled build scripts now maintain their executable bit when
inherited</li>
<li>Workspace inheritance in git dependencies is now correctly handled</li>
</ul>
<h2 id="0110---2022-12-26"><a class="header" href="#0110---2022-12-26"><a href="https://github.com/ipetkov/crane/compare/v0.10.0...v0.11.0">0.11.0</a> - 2022-12-26</a></h2>
<h3 id="added-8"><a class="header" href="#added-8">Added</a></h3>
<ul>
<li>Documentation is now available at <a href="https://crane.dev">crane.dev</a></li>
</ul>
<h3 id="changed-18"><a class="header" href="#changed-18">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: dropped compatibility for Nix versions below 2.11.0</li>
<li><strong>Breaking</strong>: dropped compatibility for nixpkgs-22.05. nixpkgs-22.11 and
nixpkgs-unstable are fully supported</li>
<li>Zstd compression of cargo artifacts now defaults to using as many cores as
<code>$NIX_BUILD_CORES</code> allows for (or all available cores if it isn't defined)</li>
<li>Dummy sources now attempt to use the same name as their original source (minus
the Nix store path and hash) to minimize errors with build scripts which
expect their full path to not change between runs</li>
</ul>
<h2 id="0100---2022-12-01"><a class="header" href="#0100---2022-12-01"><a href="https://github.com/ipetkov/crane/compare/v0.9.0...v0.10.0">0.10.0</a> - 2022-12-01</a></h2>
<h3 id="added-9"><a class="header" href="#added-9">Added</a></h3>
<ul>
<li>A new installation mode has been defined which symlinks identical cargo
artifacts against previously generated ones. This allows for linear space
usage in the Nix store across many chained derivations (as opposed to using a
zstd compressed tarball which uses quadratic space across many chained
derivations).</li>
<li><code>mkDummySrc</code> optionally accepts a <code>dummyrs</code> argument which allows for
customizing the contents of the dummy Rust files that will be generated.</li>
</ul>
<h3 id="changed-19"><a class="header" href="#changed-19">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: all cargo-based derivations will now default to using symlinking
their installed artifacts together instead of using zstd compressed tarballs.
To get the old behavior back, set <code>installCargoArtifactsMode = "use-zstd";</code> in
the derivation.
<ul>
<li>Note that <code>buildPackage</code> will continue to use zstd compressed tarballs while
building dependencies (unless either of <code>cargoArtifacts</code> or
<code>installCargoArtifactsMode</code> is defined, in which case they will be honored)</li>
</ul>
</li>
<li><strong>Breaking</strong>: the format for defining crate registries has been changed: each
registry URL should map to a set containing a <code>downloadUrl</code> attribute. This
set may also define <code>fetchurlExtraArgs</code> (another set) which will be forwarded
to the <code>fetchurl</code> invocations for crates for that registry.</li>
<li><strong>Breaking</strong> (technically): <code>buildDepsOnly</code> will now only default to running
<code>cargo check</code> with the <code>--all-targets</code> flag only if <code>doCheck = true;</code> is set on
the derivation (otherwise the flag is omitted). To get the previous behavior
back simply set <code>cargoCheckExtraArgs = "--all-targets";</code>.</li>
<li><code>registryFromGitIndex</code> now uses shallow checkouts for better performance</li>
<li><code>registryFromDownloadUrl</code> and <code>registryFromGitIndex</code> now allow specifying
<code>fetchurlExtraArgs</code> which will be forwarded to the <code>fetchurl</code> invocations for
crates for that registry</li>
</ul>
<h3 id="fixed-16"><a class="header" href="#fixed-16">Fixed</a></h3>
<ul>
<li>Unpacking a git repository now ignores duplicate crates to match cargo's
behavior</li>
<li>Sped up stripping references to source files</li>
<li>Dummy sources now import the <code>core</code> crate more robustly (playing more nicely
with <code>cargo-hakari</code>)</li>
<li>Building a crate's dependencies automatically works for uefi targets</li>
</ul>
<h2 id="090---2022-10-29"><a class="header" href="#090---2022-10-29"><a href="https://github.com/ipetkov/crane/compare/v0.8.0...v0.9.0">0.9.0</a> - 2022-10-29</a></h2>
<h3 id="changed-20"><a class="header" href="#changed-20">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: all setup hooks have been removed from the <code>packages</code> flake
output. They can still be accessed via the <code>lib</code> flake output.</li>
<li><strong>Breaking</strong>: <code>cargoBuild</code> now only runs <code>cargo build</code> in a workspace, tests
are no longer run</li>
<li><strong>Breaking</strong>: <code>buildDepsOnly</code> does not automatically imply the <code>--all-targets</code>
flag when invoking <code>cargo check</code>. Use <code>cargoCheckExtraArgs</code> to control this</li>
<li><code>buildDepsOnly</code> now accepts <code>cargoCheckExtraArgs</code> for passing additional
arguments just to the <code>cargo check</code> invocation. By default <code>--all-targets</code>
will be used</li>
<li><code>buildDepsOnly</code> now accepts <code>cargoTestExtraArgs</code> for passing additional
arguments just to the <code>cargo test</code> invocation</li>
<li><code>buildPackage</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
</ul>
<h3 id="fixed-17"><a class="header" href="#fixed-17">Fixed</a></h3>
<ul>
<li><code>crateNameFromCargoToml</code> now takes workspace inheritance into account. If a
crate does not specify <code>package.version</code> in its (root) Cargo.toml but does
specify <code>workspace.package.version</code> then the latter will be returned.</li>
<li>Freestanding (<code>#![no_std]</code>) targets are now supported</li>
</ul>
<h2 id="080---2022-10-09"><a class="header" href="#080---2022-10-09"><a href="https://github.com/ipetkov/crane/compare/v0.7.0...v0.8.0">0.8.0</a> - 2022-10-09</a></h2>
<h3 id="added-10"><a class="header" href="#added-10">Added</a></h3>
<ul>
<li><code>cargoTest</code> can now be used for only running the tests of a workspace</li>
</ul>
<h3 id="changed-21"><a class="header" href="#changed-21">Changed</a></h3>
<ul>
<li><strong>Breaking</strong> (technically): build hooks now expect helper tools (like <code>cargo</code>,
<code>jq</code>, <code>zstd</code>, etc.) to be present on the path instead of substituting a
reference to a (possibly different) executable in the store.</li>
<li><code>mkCargoDerivation</code> now automatically vendors dependencies if <code>cargoVendorDir</code>
is not defined</li>
<li><code>mkCargoDerivation</code> now automatically populates <code>pname</code> and <code>version</code> (via
<code>crateNameFromCargoToml</code>) if they are not specified</li>
<li><code>mkCargoDerivation</code> now defaults to an empty <code>checkPhaseCargoCommand</code> if not
specified</li>
<li><code>cargoAudit</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
<li><code>cargoClippy</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
<li><code>cargoDoc</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
<li><code>cargoFmt</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
<li><code>cargoNextest</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
<li><code>cargoTarpaulin</code> now delegates to <code>mkCargoDerivation</code> instead of <code>cargoBuild</code></li>
</ul>
<h3 id="fixed-18"><a class="header" href="#fixed-18">Fixed</a></h3>
<ul>
<li>Installing binaries now uses the same version of cargo as was used to build
the package (instead of using whatever version is present in nixpkgs)</li>
</ul>
<h3 id="deprecated"><a class="header" href="#deprecated">Deprecated</a></h3>
<ul>
<li>The <code>packages</code> flake output has been deprecated. All setup hooks can be
accessed via the <code>lib</code> flake output (or via the result of the <code>mkLib</code> flake
output)</li>
</ul>
<h2 id="070---2022-09-28"><a class="header" href="#070---2022-09-28"><a href="https://github.com/ipetkov/crane/compare/v0.6.0...v0.7.0">0.7.0</a> - 2022-09-28</a></h2>
<h2 id="added-11"><a class="header" href="#added-11">Added</a></h2>
<ul>
<li><code>cargoDoc</code> can now be used for building the documentation of a workspace</li>
<li><code>cleanCargoSource</code> can now be used to filter sources to only include cargo and
Rust files (and avoid rebuilds when irrelevant files change).
<code>filterCargoSources</code> is the underlying filter implementation and can be
composed with other filters</li>
<li><code>removeReferencesToVendoredSourcesHook</code> defines a post-install hook which will
remove any references to vendored sources from any installed binaries. Useful
for preventing nix from considering the binaries as having a (runtime)
dependency on said sources</li>
</ul>
<h2 id="changed-22"><a class="header" href="#changed-22">Changed</a></h2>
<ul>
<li><strong>Breaking</strong>: <code>mkCargoDerivation</code> now includes a default <code>configurePhase</code>
which does nothing but run the <code>preConfigure</code> and <code>postConfigure</code> hooks. This
is done to avoid breaking builds by including puts happen to have setup-hooks
which try to claim the configure phase (such as <code>cmake</code>). To get the old
behavior back, set <code>configurePhase = null;</code> in the derivation.</li>
<li><code>mkCargoDerivation</code> (along with any of its callers like <code>cargoBuild</code>,
<code>buildPackage</code>, etc.) now accept a <code>stdenv</code> argument which will override the
default environment (coming from <code>pkgs.stdenv</code>) for that particular derivation</li>
<li><code>mkDummySrc</code> now accepts <code>extraScript</code> which can be used to run a custom
script, and therefore customize what the dummy source contains</li>
<li><code>buildDepsOnly</code> now accepts <code>dummySrc</code> as a way to directly pass in the dummy
source to be used. Automatically derived via <code>args.src</code> if not specified.</li>
</ul>
<h2 id="fixed-19"><a class="header" href="#fixed-19">Fixed</a></h2>
<ul>
<li><code>cargoAudit</code> properly keeps any <code>audit.toml</code> files when cleaning the source</li>
<li><code>buildPackage</code> now has more robust checks to ensure that all references to
vendored sources are removed after installation (which avoids consumers of the
final binaries having to download the sources as well)</li>
<li><code>mkDummySrc</code> how handles build scripts in a manner which ensures cargo runs
the real script later (instead of thinking it has not changed)</li>
</ul>
<h2 id="060---2022-09-07"><a class="header" href="#060---2022-09-07"><a href="https://github.com/ipetkov/crane/compare/v0.5.1...v0.6.0">0.6.0</a> - 2022-09-07</a></h2>
<h3 id="added-12"><a class="header" href="#added-12">Added</a></h3>
<ul>
<li>Added <code>cargoNextest</code> for running tests via <a href="https://nexte.st/">cargo-nextest</a></li>
<li>Added <code>cargoAudit</code> for running <a href="https://crates.io/crates/cargo-audit">cargo-audit</a>
with a provided advisory database instance.</li>
</ul>
<h3 id="changed-23"><a class="header" href="#changed-23">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: the <code>--workspace</code> flag is no longer set for all cargo commands
by default. The previous behavior can be recovered by setting <code>cargoExtraArgs = "--workspace";</code> in any derivation.</li>
<li><strong>Breaking</strong>: the <code>$CARGO_PROFILE</code> environment variable can be used to specify
which cargo-profile all invocations use (by default <code>release</code> will be used).
Technically breaking if the default command was overridden for any derivation;
set <code>CARGO_PROFILE = "";</code> to avoid telling cargo to use a release build.</li>
<li><strong>Breaking</strong>: <code>cargoTarpaulin</code> will use the release profile by default</li>
<li><strong>Breaking</strong>: <code>cargoClippy</code>'s <code>cargoClippyExtraArgs</code> now default to
<code>"--all-targets"</code> instead of being specified as the cargo command itself. If
you have set <code>cargoClippyExtraArgs</code> to an explicit value and wish to retain
the previous behavior you should prepend <code>"--all-targets"</code> to it.</li>
<li><strong>Breaking</strong>: <code>remapSourcePathPrefixHook</code> and the <code>doRemapSourcePathPrefix</code>
option have been removed, and the behavior of <code>buildPackage</code> has been updated
to break false dependencies on the crate sources from the final binaries
(which was the old behavior of the <code>doRemapSourcePathPrefix</code> option). To
disable this behavior, set the <code>doNotRemoveReferencesToVendorDir</code> environment
variable to any non-empty string.</li>
<li>All cargo invocations made during the build are automatically logged</li>
<li>Vendoring git dependencies will throw a descriptive error message if a locked
revision is missing from <code>Cargo.lock</code> and a hint towards resolution</li>
</ul>
<h3 id="fixed-20"><a class="header" href="#fixed-20">Fixed</a></h3>
<ul>
<li><strong>Breaking</strong>: <code>vendorGitDeps</code> will only include crates referenced by the
<code>Cargo.lock</code> file, meaning any extraneous crates which happen to be present in
the git repository will be ignored.</li>
</ul>
<h2 id="051---2022-07-20"><a class="header" href="#051---2022-07-20"><a href="https://github.com/ipetkov/crane/compare/v0.5.0...v0.5.1">0.5.1</a> - 2022-07-20</a></h2>
<h3 id="added-13"><a class="header" href="#added-13">Added</a></h3>
<ul>
<li>Added <code>.overrideToolchain</code> as a convenience for using a custom rust toolchain</li>
</ul>
<h3 id="fixed-21"><a class="header" href="#fixed-21">Fixed</a></h3>
<ul>
<li>Fixed an issue where <code>mkDummySrc</code> would produce incorrect results for filtered
sources: #46</li>
</ul>
<h2 id="050---2022-06-12"><a class="header" href="#050---2022-06-12"><a href="https://github.com/ipetkov/crane/compare/v0.4.1...v0.5.0">0.5.0</a> - 2022-06-12</a></h2>
<h3 id="changed-24"><a class="header" href="#changed-24">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: dropped compatibility for Nix versions below 2.8.1</li>
<li><strong>Breaking</strong>: updated all flake attributes to follow the new <code>.default</code>
guidance as per Nix's warnings. Specifically:
<ul>
<li>Crane's default overlay is now available at <code>.overlays.default</code> (previously
<code>.overlay</code>)</li>
<li>All templates now use <code>{app,devShells,packages}.default</code> as well</li>
</ul>
</li>
<li><strong>Breaking</strong>: <code>lib.fromTOML</code> and <code>lib.toTOML</code> have been removed in favor of
<code>builtins.fromTOML</code></li>
<li>Improved support for consuming <code>crane</code> without using flakes</li>
<li>The <code>nix-std</code> dependency has been dropped</li>
</ul>
<h2 id="041---2022-05-29"><a class="header" href="#041---2022-05-29"><a href="https://github.com/ipetkov/crane/compare/v0.4.0...v0.4.1">0.4.1</a> - 2022-05-29</a></h2>
<h3 id="fixed-22"><a class="header" href="#fixed-22">Fixed</a></h3>
<ul>
<li>Dummy source derivations go to greater lengths to only depend on the files
they consume. Specifying the entire flake source as an input (e.g. via
<code>buildPackage { src = self; }</code>) now avoids rebuilding everything from scratch
whenever <em>any</em> file is changed. #28</li>
</ul>
<h2 id="040---2022-05-10"><a class="header" href="#040---2022-05-10"><a href="https://github.com/ipetkov/crane/compare/v0.3.3...v0.4.0">0.4.0</a> - 2022-05-10</a></h2>
<h3 id="changed-25"><a class="header" href="#changed-25">Changed</a></h3>
<ul>
<li><strong>Breaking</strong>: the previously named <code>utils</code> flake input has been renamed to
<code>flake-utils</code></li>
<li><code>buildDepsOnly</code> now adds <code>--all-targets</code> to the default <code>cargo check</code> invocation. This allows caching all artifacts (including from
dev-dependencies) such that tools like clippy don't have to generate them
every time they run.</li>
<li>Templates now use the newer flake format accepted by Nix 2.8 (e.g.
<code>{packages,overlays,devShells}.default</code>, etc.)</li>
</ul>
<h3 id="fixed-23"><a class="header" href="#fixed-23">Fixed</a></h3>
<ul>
<li>Fixed project and template flakes to avoid superfluous follows declaration for
<code>flake-utils</code></li>
<li>Fixed quoting of relative paths to allow building with external sources</li>
</ul>
<h2 id="033---2022-02-24"><a class="header" href="#033---2022-02-24"><a href="https://github.com/ipetkov/crane/compare/v0.3.2...v0.3.3">0.3.3</a> - 2022-02-24</a></h2>
<h3 id="fixed-24"><a class="header" href="#fixed-24">Fixed</a></h3>
<ul>
<li>Use <code>lib.groupBy</code> if <code>builtins.groupBy</code> isn't available (i.e. if a Nix version
earlier than 2.5 is used)</li>
<li>The cross compilation example also hows how to set the <code>HOST_CC</code> environment
variable which may be required by some build scripts to function properly</li>
</ul>
<h2 id="032---2022-02-18"><a class="header" href="#032---2022-02-18"><a href="https://github.com/ipetkov/crane/compare/v0.3.1...v0.3.2">0.3.2</a> - 2022-02-18</a></h2>
<h3 id="fixed-25"><a class="header" href="#fixed-25">Fixed</a></h3>
<ul>
<li>Fixed handling git dependencies whose locked revision is not on the
repository's main branch</li>
</ul>
<h2 id="031---2022-02-17"><a class="header" href="#031---2022-02-17"><a href="https://github.com/ipetkov/crane/compare/v0.3.0...v0.3.1">0.3.1</a> - 2022-02-17</a></h2>
<h3 id="added-14"><a class="header" href="#added-14">Added</a></h3>
<ul>
<li>Added template and example for cross compiling to other platforms</li>
<li>Added template and example for building static binaries using musl</li>
</ul>
<h3 id="changed-26"><a class="header" href="#changed-26">Changed</a></h3>
<ul>
<li><code>cargoClippy</code> and <code>cargoTarpaulin</code> will install cargo artifacts by default (or
install an empty <code>target</code> directory if there are none). This allows for more
easily chaining derivations if doing so is desired.
<ul>
<li>This can be disabled by setting <code>doInstallCargoArtifacts = false;</code> in the
derivation</li>
</ul>
</li>
</ul>
<h3 id="fixed-26"><a class="header" href="#fixed-26">Fixed</a></h3>
<ul>
<li>Fixed an issue where cross compiling would try to needlessly cross compile
rustc and cargo themselves</li>
</ul>
<h2 id="030---2022-02-11"><a class="header" href="#030---2022-02-11"><a href="https://github.com/ipetkov/crane/compare/v0.2.1...v0.3.0">0.3.0</a> - 2022-02-11</a></h2>
<h3 id="added-15"><a class="header" href="#added-15">Added</a></h3>
<ul>
<li><code>downloadCargoPackageFromGit</code> has been added to handle downloading and
unpacking a cargo workspace from a git repository</li>
<li><code>vendorCargoRegistries</code> has been added to handle vendoring crates from all
registries used in a <code>Cargo.lock</code> file</li>
<li><code>vendorGitDeps</code> has been added to handle vendoring crates from all git sources
used in a <code>Cargo.lock</code> file</li>
</ul>
<h3 id="changed-27"><a class="header" href="#changed-27">Changed</a></h3>
<ul>
<li><code>vendorCargoDeps</code> now automatically handles git dependencies by default
<ul>
<li>Git dependencies will be vendored as another source in the output derivation</li>
<li>The cargo configuration is done such that the sources are available to use
when it decides, without overriding that crate for the entire workspace
<ul>
<li>For example, if your workspace contains a crate only used for testing
which has a git dependency of a crate used by other parts of the
workspace, then only that crate will use the git dependency. The rest of
the workspace will continue to use the crates.io version, just like cargo
behaves when used outside of Nix.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="021---2022-02-11"><a class="header" href="#021---2022-02-11"><a href="https://github.com/ipetkov/crane/compare/v0.2.0...v0.2.1">0.2.1</a> - 2022-02-11</a></h2>
<h3 id="changed-28"><a class="header" href="#changed-28">Changed</a></h3>
<ul>
<li><code>cargoFmt</code> will install cargo artifacts by default (or install an empty
<code>target</code> directory if there are none). This allows for more easily chaining
derivations if doing so is desired.
<ul>
<li>This can be disabled by setting <code>doInstallCargoArtifacts = false;</code> in the
derivation</li>
</ul>
</li>
</ul>
<h2 id="020---2022-01-30"><a class="header" href="#020---2022-01-30"><a href="https://github.com/ipetkov/crane/compare/v0.1.0...v0.2.0">0.2.0</a> - 2022-01-30</a></h2>
<h3 id="added-16"><a class="header" href="#added-16">Added</a></h3>
<ul>
<li>Support for alternative cargo registries</li>
</ul>
<h3 id="changed-29"><a class="header" href="#changed-29">Changed</a></h3>
<ul>
<li><code>urlForCargoPackage</code> now takes configured registries into account when
downloading crate sources</li>
<li><strong>Breaking</strong>: <code>vendorCargoDeps</code> now vendors each unique registry as a subdirectory within
the derivation's output. A <code>config.toml</code> file is also placed at the output
root which contains the necessary configurations to point cargo at the
vendored sources.</li>
<li><code>configureCargoVendoredDepsHook</code> is now aware of the updated <code>vendorCargoDeps</code>
output format, and will use the <code>config.toml</code> file it generates if it is
present. Otherwise it will fall back to the previous behavior (which is treat
the entire directory as only vendoring crates.io).</li>
<li>Source vendoring now uses <code>runCommandLocal</code> (instead of <code>runCommand</code>) to
reduce network pressure in trying to fetch results which can quickly be built
locally</li>
<li>Searching for <code>Cargo.toml</code> or <code>.cargo/config.toml</code> files is now done more
efficiently</li>
</ul>
<h2 id="010---2022-01-22"><a class="header" href="#010---2022-01-22">0.1.0 - 2022-01-22</a></h2>
<ul>
<li>First release</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="introduction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="introduction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
